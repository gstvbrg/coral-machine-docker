# Minimal builder image for GPU validation sandbox
# Installs lightweight toolchain and reuses existing Coral Machine installers

FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

# Install essential build utilities (intentionally omit TBB)
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    cmake \
    ninja-build \
    git \
    curl \
    wget \
    ca-certificates \
    expect \
    pv \
    ccache \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Copy shared configuration and installer infrastructure
COPY config.env /setup/
COPY lib/ /setup/lib/
COPY installers/00-prep.sh /setup/installers/
COPY installers/01-compilers.sh /setup/installers/
COPY installers/03-core-libraries.sh /setup/installers/

# Copy GPU validation helper scripts (added later in this directory)
COPY gpu_validation/scripts/ /setup/gpu-validation/scripts/

# Ensure scripts are executable after copy
RUN find /setup -type f -name '*.sh' -exec chmod +x {} +

WORKDIR /setup

CMD ["/bin/bash"]
